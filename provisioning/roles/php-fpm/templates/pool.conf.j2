; Generated by Ansible at {{ ansible_date_time.iso8601 }}

[{{ item.name }}]

user = {{ item.process_user }}
group = {{ item.process_group | default(item.process_user) }}

listen = {{ item.listen | default('/run/php-fpm/$pool.sock') }}
listen.owner = {{ item.listen_owner | default(item.process_user) }}
listen.group = {{ item.listen_group | default(item.listen_owner) | default(item.process_user) }}
listen.mode = {{ item.listen_mode | default('0660') }}

pm = ondemand
pm.max_children = 3
pm.process_idle_timeout = 10s
pm.max_requests = 0
pm.status_path = /php-fpm-status-$pool

;access.log = /var/log/php-fpm/$pool-access.log
{% if item.access_log is defined -%}
access.log = {{ item.access_log }}
access.format = {{ item.access_format | default('"%R - %u %t \"%m %r%Q%q\" %s %f %{mili}d %{kilo}M %C%% %p"') }}
{% endif %}

slowlog = {{ item.slowlog | default('/var/log/php-fpm/$pool-slow.log') }}
request_slowlog_timeout = {{ item.slowlog_timeout | default('0') }}
request_terminate_timeout = {{ item.terminate_timeout | default('0') }}
catch_workers_output = {{ item.workers_output | default('no') }}

; error_log must be writable by user/group or process
php_admin_flag[log_errors] = {{ item.log_errors | default('on') }}
php_admin_value[error_log] = {{ item.error_log | default('/var/log/php-fpm/$pool-error.log') }}
php_flag[display_errors] = {{ item.display_errors | default('off') }}
php_admin_value[memory_limit] = 128M

; Set data paths to directories owned by process user
php_value[session.save_handler] = files
php_value[session.save_path]    = /var/lib/php/fpm/session
php_value[soap.wsdl_cache_dir]  = /var/lib/php/fpm/wsdlcache
;php_value[opcache.file_cache]   = /var/lib/php/fpm/opcache
